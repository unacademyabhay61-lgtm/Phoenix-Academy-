<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phoenix Academy - Online Test</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        body { margin: 0; font-family: sans-serif; background: #0b0f19; color: white; display: flex; height: 100vh; }
        .sidebar { width: 85px; background: #0d1117; border-right: 1px solid #1f2937; display: flex; flex-direction: column; align-items: center; padding-top: 25px; gap: 25px; }
        .nav-link { text-decoration: none; color: #9ca3af; font-size: 10px; text-align: center; display: flex; flex-direction: column; gap: 6px; }
        .nav-link.active { color: #3db2ff; }
        .icon-box { width: 42px; height: 42px; background: #161b22; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .active .icon-box { background: rgba(61, 178, 255, 0.1); border: 1px solid #3db2ff; color: #3db2ff; }

        .main { flex: 1; padding: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #quiz-container { background: #161b22; width: 100%; max-width: 500px; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .option-btn { width: 100%; background: #1c2128; border: 1px solid #333; color: white; padding: 15px; margin-top: 10px; border-radius: 12px; text-align: left; cursor: pointer; transition: 0.3s; }
        .option-btn:hover { border-color: #3db2ff; background: #252d38; }
        .option-btn.selected { background: #3db2ff; color: white; border-color: #3db2ff; }
        #next-btn { background: #3db2ff; color: white; border: none; padding: 12px 30px; border-radius: 10px; margin-top: 20px; font-weight: bold; cursor: pointer; display: none; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="sidebar">
        <a href="dashboard.html" class="nav-link"><div class="icon-box">üìä</div><span>Dash</span></a>
        <a href="planner.html" class="nav-link"><div class="icon-box">üìÖ</div><span>Planner</span></a>
        <a href="tests.html" class="nav-link active"><div class="icon-box">üèÜ</div><span>Tests</span></a>
    </div>

    <div class="main">
        <div id="quiz-container">
            <div id="question-area">
                <h3 id="q-text">Loading Questions...</h3>
                <div id="options-list"></div>
                <button id="next-btn" onclick="nextQuestion()">Next Question ‚Üí</button>
            </div>
            <div id="result-area" class="hidden">
                <h2 style="color:#3db2ff">Test Completed! üéâ</h2>
                <p id="score-text" style="font-size: 24px;"></p>
                <button onclick="location.reload()" style="background:#1c2128; color:white; border:1px solid #333; padding:10px 20px; border-radius:10px;">Retake Test</button>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyA7MHXGSN-ZIybG8sEZiP9kDaWIHRYCfT8",
            authDomain: "phnoenix-coaching.firebaseapp.com",
            projectId: "phnoenix-coaching",
            appId: "1:56032052098:web:43d562162215be0eb3459b"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let questions = [];
        let currentIdx = 0;
        let score = 0;

        // Fetch Questions from Admin [Collection Name: 'polls']
        db.collection("polls").onSnapshot((snapshot) => {
            questions = [];
            snapshot.forEach(doc => questions.push(doc.data()));
            if(questions.length > 0) showQuestion();
            else document.getElementById('q-text').innerText = "No Tests available right now.";
        });

        function showQuestion() {
            let q = questions[currentIdx];
            document.getElementById('q-text').innerText = q.question;
            const optList = document.getElementById('options-list');
            optList.innerHTML = "";
            document.getElementById('next-btn').style.display = "none";

            q.options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = "option-btn";
                btn.innerText = opt;
                btn.onclick = () => selectOption(btn, opt === q.answer);
                optList.appendChild(btn);
            });
        }

        function selectOption(btn, isCorrect) {
            document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            if(isCorrect) score++;
            document.getElementById('next-btn').style.display = "block";
        }

        function nextQuestion() {
            currentIdx++;
            if(currentIdx < questions.length) showQuestion();
            else showResult();
        }

        function showResult() {
            document.getElementById('question-area').classList.add('hidden');
            document.getElementById('result-area').classList.remove('hidden');
            document.getElementById('score-text').innerText = `Your Score: ${score} / ${questions.length}`;
        }
        function showResult() {
    document.getElementById('question-area').classList.add('hidden');
    document.getElementById('result-area').classList.remove('hidden');
    document.getElementById('score-text').innerText = `Your Score: ${score} / ${questions.length}`;

    // Analytics Save karne ka logic
    const userEmail = localStorage.getItem("userEmail") || "Anonymous"; 
    db.collection("test_results").add({
        student: userEmail,
        score: score,
        total: questions.length,
        subject: "Life Processes",
        date: new Date().toLocaleString(),
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });
        }
        
    </script>
</body>
</html>
